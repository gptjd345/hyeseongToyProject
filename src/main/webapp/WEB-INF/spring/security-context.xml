<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:mybatis-spring="http://mybatis.org/schema/mybatis-spring"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd
		http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring-1.2.xsd
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd">
	
	<!-- Annotaion 활성화 -->
	<mvc:annotation-driven/>
		
    <!-- @Secured 어노테이션 설정 -->
    <security:global-method-security secured-annotations="enabled" proxy-target-class="true" />
    
    <!-- 로그인, 로그아웃 및 권한별 접근 url 설정. -->
    <!-- use-expressions: true SpEL문법 사용 -->
    <!-- DB 연동 설정  -->
    <security:http auto-config="true" use-expressions="true">
        
        <!-- url별 접근 권한 설정 -->
        <security:intercept-url pattern="/resources/**" access="permitAll" /> 
        <security:intercept-url pattern="/member/list.do" access="permitAll" /> 
        <security:intercept-url pattern="/**" access="permitAll" /> 
        
        <!-- 로그인 설정 -->
        <security:form-login 
        	login-page="/member/login" 
        	username-parameter="userid" 
        	password-parameter="password"
            default-target-url="/" 
          	authentication-failure-handler-ref="userLoginFailHandler"
        />
        <!-- authentication-failure-url="/member/login" 이 부분 제거  -->
        
        <!-- 로그아웃 설정 -->
        <security:logout 
        	logout-url="/member/logout.do"
        	logout-success-url="/member/login" 
        />
        
    </security:http>
    
  
        <!-- DB 연동 설정 user-service-ref: DB인증을 처리할 Bean 객체 이름 -->
		<security:authentication-manager>
			<security:authentication-provider user-service-ref="userService">
			</security:authentication-provider>
		</security:authentication-manager>
		
	<bean id="userService" class="com.example.toyProject.service.member.CustomUserDetailsService"></bean>
	
    <bean id="userLoginFailHandler" class="com.example.toyProject.service.member.CustomUserDetailsService"></bean>
    
</beans>